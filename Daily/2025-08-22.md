# Two - blog post

# Creating Mobile app using Tauri + Svelte
The goal of the project [Two](https://github.com/minosiants/two) is to get familiar with [Tauri](https://v2.tauri.app/) - rust framework for creation cross platform apps. This project aims android and ios apps.

## The functionality of the [Two](https://github.com/minosiants/two) app 
It helps to learn phone numbers of the contacts from a phone contacts book.
I should say that the functionality is not so important in this case since the main goal is the familiarity with creation of mobile apps using Tauri.

The app has only two screens:
<img src="docs/media/two-contacts-list.png" alt="contacts list" width="50%">
<img src="docs/media/two-card.png" alt="card" width="50%">


- Contacts that are wanted to be learned selected from the contacts list.
- Card shows a contact and expects to a phone be entered. After submit it checks and shows a correct phone.


## What I learned

### Palete
#### Pantone
To choose colors for the app I used  [The complete color harmony ](https://www.pantone.com/products/trend-books/the-complete-color-harmony-pantone-edition) book. 
In the color theory each color or combination of them influence of human emotions. From the book I choose palete for casual mood. 
Here is a combination of colors
<img src="docs/media/pantone-1535-cp.webp" alt="contacts list" width="50%">

<img src="docs/media/pantone-2311-cp.webp" alt="card" width="50%">

<img src="docs/media/pantone-2466-cp.webp" alt="card" width="50%">

<img src="docs/media/pantone-18-1535-tcx.webp" alt="card" width="50%">

### CSS 
In css colors can be represented as [hsl()](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/hsl) function. This function is based on [Munsell color system](https://en.wikipedia.org/wiki/Munsell_color_system) 
 - h - Hue
 - s - Saturation ( Chroma )
 - l - Lightness  ( Value )
This representation is very convenient. Hue is a color representation and saturation and lightness help to create [monochrome](https://en.wikipedia.org/wiki/Monochrome) colors which is very handy in the UI development.

In my case I was only changing Saturation. Using Pantone color as a middle value and changing saturation in step of 5%. 
Code could be found here [Colors.svelte](https://github.com/minosiants/two/blob/master/src/lib/components/Colors.svelte).

The final colors set is [vars.css](https://github.com/minosiants/two/blob/master/static/css/vars.css#L83)
```css
  --bgColor-primary: var(--color-2566CP-1);
  --bgColor-primary-light: var(--color-2566CP-7);
  --bgColor-second: var(--color-2311CP-3);
  --color-primary: var(--color-2311CP-3);
  --color-second: var(--color-2566CP-1);
  --accentColor-primary: var(--color-1535UP-10);
  --accentColor-second: var(--color-1535UP-10);
  --btnColor-primary: var(--accentColor-primary);
  --borderColor-primary: var(--color-1535UP-2);
```

For a layout I used approach based on [Every Layout](https://every-layout.dev/) book. (This book is fantastic).
### Svelte

[Svelte](https://svelte.dev/) is a grate way to build UI. It feels so natural to the actual vanilla web development. 
There are few resource that I used as a reference of svelte ui development
- [Leo](https://github.com/brave/leo) - it is [Brave](https://brave.com/) web browser ui components.
- [Svelte 5](https://github.com/topics/svelte-5) github topic
- [Svelte 5 router](https://github.com/mateothegreat/svelte5-router)
- [Component Library](https://shadcn-svelte.com/)

One thing that I struggled with was a svelte state management.
I wanted to load contacts lists from the phone book of stored file and managed its state across the app.
Here is the approuch.
- [contacts.svelte.js](https://github.com/minosiants/two/blob/master/src/lib/js/contacts.svelte.js) - file responsible for contacts management logic across the app. Svelte in its name allows to use [svelte runners](https://svelte.dev/docs/svelte/what-are-runes) in may case it was `$state()` 
- [contactsState](https://github.com/minosiants/two/blob/master/src/lib/js/contacts.svelte.js#L42) is created here. Loaded here [layout.js](https://github.com/minosiants/two/blob/master/src/routes/%2Blayout.js#L11) (load function is called by svelte before component is created). Initialised here [+layout.svelte](https://github.com/minosiants/two/blob/master/src/routes/%2Blayout.svelte#L6) . Then it can be used across the app in the reactive way. One thing to mention is when I want to [update contactState](https://github.com/minosiants/two/blob/master/src/lib/js/contacts.svelte.js#L49) I delete all values from the `value` state and add all new values. If just replace `value` in `contactState.value` with a new array reactance is gone.


### Tauri
This is my first experience with [Tauri](https://v2.tauri.app/).  First impression is like a good way to build cross platform apps. I will not explain all Tauri idea and projects bootstrapping. It can be found in [Tauri quick start](https://v2.tauri.app/start/).
To interact with a native os, in my case with Android and iOS, tauri plugins are used. Tauri already has a good list of [plugins](https://github.com/tauri-apps/plugins-workspace). For example  I used [file system plulgin](https://github.com/tauri-apps/plugins-workspace/tree/v2/plugins/fs) to store the apps state in the file system. Also I created a new plugin to get access to a contacts list on each mobile platform. What I found difficult is the way to develop and debug plugins' native code on each mobile platform.

Here I will highlight some parts that were not very obvious for me.
#### Start developing a project with  a plugin these commands should be run 
- `pnpm create tauri-app project-name`
- `cd project-name`
- `pnpm tauri android init`
- `pnpm tauri ios init`
- `pnpm tauri plugin new --directory /full-path/project-name/plugins/plugin-name plugin-name`
- `cd plugin-name`
- `pnpm tauri plugin android init`
- `pnpm tauri plugin ios init`

#### Access users sensitive content on the phone

For `android` add to [AndroidManifest.xml](https://github.com/minosiants/two/blob/master/src-tauri/gen/android/app/src/main/AndroidManifest.xml)
```
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_CONTACTS" />
```

For `iOS` add to [Info.plist](https://github.com/minosiants/two/blob/master/src-tauri/gen/apple/two_iOS/Info.plist)
```
<key>NSContactsUsageDescription</key>
	<string>This app needs access to your contacts to show them in your contact list.</string>
```

to [PrivacyInfo.xcprivacy](https://github.com/minosiants/two/blob/master/src-tauri/gen/apple/PrivacyInfo.xcprivacy)

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>NSPrivacyAccessedAPITypes</key>
    <array>
      <dict>
        <key>NSPrivacyAccessedAPIType</key>
        <string>NSPrivacyAccessedAPICategoryFileTimestamp</string>
        <key>NSPrivacyAccessedAPITypeReasons</key>
        <array>
          <string>C617.1</string>
        </array>
      </dict>
    </array>
  </dict>
</plist>
```


 This was a confgs part. Apps need to get permissions at runtime as well. For this Tauri already provides two `commands`  
so we need to expose them  `check_permissions` `request_permissions` look into these files
[commands.rs](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/src/commands.rs)
[mobile.rs](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/src/mobile.rs)
[index.ts](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/guest-js/index.ts) - expose commands to javascript
[default.toml](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/permissions/default.toml) 

In android part plugin should have permissions annotation [ContactsPlugin.ktl](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/android/src/main/java/ContactsPlugin.kt#L19)

In iOS part  [ContactsPlugin.swift](https://github.com/minosiants/two/blob/master/src-tauri/plugins/contacts/ios/Sources/ContactsPlugin.swift) `checkPermissions` and `requestPermissions` should be overwritten.

Permission state has three types `prompt` | `denied` | `granted`

this is example how these commands are used in [contacts.svelte.js](https://github.com/minosiants/two/blob/master/src/lib/js/contacts.svelte.js#L71)

---

## Commands
`pnpm tauri info` - gives the info about the project.
`pnpm tauri ios  dev --open` - run project on ios emulator. If it is already open omit `--open`
`pnpm tauri android dev --open` - run project on android emulator. If it is already open omit `---open` 

## Resources 
- For iOS development [xcode](https://developer.apple.com/xcode/) is required
- For Android development [android studio](https://developer.android.com/studio) is required
- [Android API reference](https://developer.android.com/reference)
- [Apple developer documentation](https://developer.apple.com/documentation)
-  [tauri ios plugins](https://github.com/Lynx-Eco/tauri_ios_plugins) - this repo holds a bunch of ios related plugins.



